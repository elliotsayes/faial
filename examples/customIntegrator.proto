(kernel
  (locations sumBuffer tempBuffer result)
  (const blockDim_x SUM_BUFFER_SIZE)
  (pre (< blockDim_x SUM_BUFFER_SIZE))
  (begin
    (loop (range index (div SUM_BUFFER_SIZE blockDim_x))
      (loc sumBuffer (ro (* index blockDim_x) true)))

    (loc tempBuffer (rw $tid true))
    (loop (range i (div SUM_BUFFER_SIZE 2))
      (begin
        sync
        (loc tempBuffer
          (rw $tid
            (and
              (= (mod $tid (* i 2)) 0)
              (< $tid WORK_GROUP_SIZE))))
        (loc tempBuffer
          (ro $tid
            (and
              (= (mod $tid (* i 2)) 0)
              (< (+ $tid 1) WORK_GROUP_SIZE))))
      )
    )
    (loc result (rw 0 (= 0 $tid)))
    (loc tempBuffer (ro 0 (= 0 $tid)))
  )
)