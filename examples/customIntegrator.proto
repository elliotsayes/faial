(begin
  (loc x (ro (* idx $tid) (range idx 999) true))
  (loc x (rw $tid true))
  (loop (range i 999)
    (begin
      sync
      (loc tempBuffer (rw $tid (= (mod $tid (* i 2)) 0)))
    )
  )
  (loc tempBuffer (ro 0 (= idx $tid)))
)
