#|
https://github.com/NVIDIA/cuda-samples/blob/master/Samples/shfl_scan/shfl_scan.cu#L132
|#

shared data, partial_sums, buf;

const local blockIdx, local threadIdx
where
  # Standard CUDA restrictions
  distinct [blockIdx][threadIdx];

# __shared__ data accesses are prefixed with blockIdx
if (threadIdx == 0) {
  rw buf[blockIdx];
  ro partial_sums[blockIdx];
}
sync;
rw data[blockIdx][threadIdx];
# __shared__ data accesses are prefixed with blockIdx
ro buf[blockIdx];
