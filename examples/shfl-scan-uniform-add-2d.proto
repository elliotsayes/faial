#|
https://github.com/NVIDIA/cuda-samples/blob/master/Samples/shfl_scan/shfl_scan.cu#L132
|#

shared data, partial_sums, buf;

const local blockIdx, local threadIdx;

# Standard CUDA restrictions
assert distinct [blockIdx][threadIdx];

# __shared__ data accesses are prefixed with blockIdx
rw buf[blockIdx] if threadIdx == 0;
ro partial_sums[blockIdx] if threadIdx == 0;
sync;
rw data[blockIdx][threadIdx];
# __shared__ data accesses are prefixed with blockIdx
ro buf[blockIdx];
